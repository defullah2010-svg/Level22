<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø§Ù„Ø·Ø§Ù„Ø¨Ø© </title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
@font-face {
  font-family: 'HelveticaNeueW23';
  src: url('fonts/HelveticaNeueW23-Regular.ttf') format('truetype');
}
body, input, select, label, button {
  font-family: 'HelveticaNeueW23', Arial, sans-serif;
  margin:0; padding:0;
}
header { background:#8A7230; color:white; text-align:center; padding:15px; }
header h1 { margin:0; font-size:18px; }

label {
  display:block;
  margin:5px 0 2px;
  font-weight:bold;
  font-size:12px;
  background:transparent;
  text-align:center;
}

input, textarea, select {
  width:100%;
  padding:6px;
  border:1px solid #c2c1c2;
  border-radius:4px;
  margin-bottom:5px;
  box-sizing:border-box;
  font-size:12px;
  text-align:center;
  background-color: white;
}

button {
  background:#0c8380;
  color:white;
  border:none;
  padding:12px 0;
  margin-top:10px;
  cursor:pointer;
  border-radius:6px;
  font-size:16px;
  font-weight:bold;
  width:100%;
  display:block;
  text-align:center;
}

#studentChart { width:100%; height:320px; margin-top:10px; }

.rating-display {
  display:block; 
  text-align:center; 
  margin-top:5px; 
  font-weight:bold; 
  color:#d73027; 
  font-size:16px;
  background-color:#f9eaea;
  border-radius:6px;
  padding:5px;
}

/* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙˆÙŠÙ‡ */
.overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}
.popup {
  background: #fff;
  padding: 20px;
  max-width: 350px;
  text-align: center;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  animation: fadeIn 0.4s ease;
}
.popup h2 { margin-top: 0; color: #333; font-size: 20px; }
.popup p { color: #555; font-size: 16px; margin: 15px 0; }
.popup button {
  padding: 10px 20px;
  background: #008CBA;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 15px;
  transition: 0.3s;
}
.popup button:hover { background: #005f7a; }
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

@media print {
  button { display:none; }
  select { display:none; }
  .hide-label-print label { display:none; }
}
</style>
</head>
<body>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ†ÙˆÙŠÙ‡ -->
<div class="overlay" id="popupOverlay">
  <div class="popup">
    <h2>ğŸ’¡ ØªÙ†ÙˆÙŠÙ‡</h2>
    <p>Ø±Ø³ÙˆÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· <strong>10 Ø±ÙŠØ§Ù„</strong>.<br>
       ØªØ¯ÙØ¹ Ø§Ù„Ø±Ø³ÙˆÙ… Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¬Ø§Ù†Ù‹Ø§ Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„ÙƒÙ† Ø¨Ø¯ÙØ¹Ùƒ Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ¬Ø¹Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ø­Ù„Ø§Ù„Ù‹Ø§ ÙˆØªØ¯Ø¹Ù… Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ£Ø°Ù†Øª Ù„Ù…Ù† ÙŠØ´Ù‡Ø¯ ÙˆØ§Ù„Ù„Ù‡ Ø®ÙŠØ± Ø§Ù„Ø´Ø§Ù‡Ø¯ÙŠÙ†.</p>
    <img src="images/cash.png" alt="cash" style="max-width:150px; margin:10px 0;">
    <button onclick="closePopup()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<header><h1>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø§Ù„Ø·Ø§Ù„Ø¨Ø© </h1></header>

<div style="max-width:800px; margin:auto; padding:10px;">

<!-- Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© -->
<div style="display:flex; gap:10px; justify-content:center;">
  <div><label>Ø¥Ø¯Ø§Ø±Ø© ØªØ¹Ù„ÙŠÙ… Ù…Ù†Ø·Ù‚Ø©</label><input type="text"></div>
  <div><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label><input type="text"></div>
</div>

<!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ù…Ø¹Ù„Ù…Ø© ÙˆØ§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„ÙØµÙ„ -->
<div style="display:flex; gap:10px; justify-content:center;">
  <div><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</label><input type="text"></div>
  <div><label>Ø§Ù„Ù…Ø§Ø¯Ø©</label><input type="text"></div>
  <div><label>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label><input type="text"></div>
</div>

<!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø·Ø§Ù„Ø¨Ø©  ÙˆØ§Ù„ØµÙ ÙˆØ§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® -->
<div style="display:flex; gap:10px; justify-content:center;">
  <div><label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø© </label><input type="text"></div>
  <div><label>Ø§Ù„ØµÙ</label><input type="text"></div>
  <div><label>Ø§Ù„ÙŠÙˆÙ…</label><input type="text"></div>
  <div><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="text" id="dateInput"></div>
</div>

<!-- Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ù‚ÙˆØ§Ø¦Ù… Ù…Ù†Ø³Ø¯Ù„Ø© 0%-100% -->
<div style="display:flex; gap:10px; justify-content:center;" class="hide-label-print">
  <div>
    <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…</label>
    <select id="selEdu" onchange="updateChartAndInputs()">
      <option value="0">0%</option><option value="10">10%</option><option value="20">20%</option>
      <option value="30">30%</option><option value="40">40%</option><option value="50">50%</option>
      <option value="60">60%</option><option value="70">70%</option>
      <option value="80">80%</option><option value="90">90%</option>
      <option value="100">100%</option>
    </select>
    <div id="displayEdu" class="rating-display"></div>
  </div>

  <div>
    <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ù„ÙˆÙƒ</label>
    <select id="selBeh" onchange="updateChartAndInputs()">
      <option value="0">0%</option><option value="10">10%</option><option value="20">20%</option>
      <option value="30">30%</option><option value="40">40%</option><option value="50">50%</option>
      <option value="60">60%</option><option value="70">70%</option>
      <option value="80">80%</option><option value="90">90%</option>
      <option value="100">100%</option>
    </select>
    <div id="displayBeh" class="rating-display"></div>
  </div>

  <div>
    <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ§Ø¸Ø¨Ø©</label>
    <select id="selAtt" onchange="updateChartAndInputs()">
      <option value="0">0%</option><option value="10">10%</option><option value="20">20%</option>
      <option value="30">30%</option><option value="40">40%</option><option value="50">50%</option>
      <option value="60">60%</option><option value="70">70%</option>
      <option value="80">80%</option><option value="90">90%</option>
      <option value="100">100%</option>
    </select>
    <div id="displayAtt" class="rating-display"></div>
  </div>
</div>

<!-- Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³: Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø© -->
<div>
<label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</label>
<input type="text" id="teacherNotes">
</div>

<!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ 2D -->
<h5 style="text-align:center; margin-top:12px;">Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù„Ø¨Ø©  </h5>
<div id="studentChart"></div>

<!-- Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³: Ø§Ù„Ù…ÙˆØ¬Ù‡ ÙˆØ§Ù„Ù…Ø¯ÙŠØ± -->
<div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
  <div><label>Ø§Ù„Ù…ÙˆØ¬Ù‡Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ© </label><input type="text" id="supervisor"></div>
  <div><label>Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label><input type="text"></div>
</div>

<button onclick="printPDF()">Ø·Ø¨Ø§Ø¹Ø© PDF</button>

</div>

<script>
// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ†ÙˆÙŠÙ‡
function closePopup() { document.getElementById("popupOverlay").style.display = "none"; }

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø©
function ratingText(val){
  if(val>=90) return "Ù…Ù…ØªØ§Ø²";
  if(val>=80) return "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§";
  if(val>=70) return "Ø¬ÙŠØ¯";
  if(val>=60) return "Ù…Ù‚Ø¨ÙˆÙ„";
  return "Ø¶Ø¹ÙŠÙ";
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ÙˆØ­Ù‚ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¶
function updateChartAndInputs(){
  const vEdu = Number(document.getElementById('selEdu').value);
  const vBeh = Number(document.getElementById('selBeh').value);
  const vAtt = Number(document.getElementById('selAtt').value);

  document.getElementById('displayEdu').textContent = `${ratingText(vEdu)} ${vEdu}%`;
  document.getElementById('displayBeh').textContent = `${ratingText(vBeh)} ${vBeh}%`;
  document.getElementById('displayAtt').textContent = `${ratingText(vAtt)} ${vAtt}%`;

  const values = [vEdu,vBeh,vAtt];
  const labels = ['Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…','Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ù„ÙˆÙƒ','Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ§Ø¸Ø¨Ø©'];
  const texts = [
    `${ratingText(vEdu)} %${vEdu}`,
    `${ratingText(vBeh)} %${vBeh}`,
    `${ratingText(vAtt)} %${vAtt}`
  ];

  const trace = {
    x: labels,
    y: values,
    type:'bar',
    text: texts,
    textposition:'auto',
    hoverinfo: 'none',
    marker: { color:['#56CC8A','#FFBD80','#58A5ED'] },
    textfont: { family: 'HelveticaNeueW23, Arial, sans-serif', size: 12, color: 'black' }
  };

  const layout = { margin:{l:40,r:20,b:40,t:40}, yaxis:{title:'Ø§Ù„Ù†Ø³Ø¨Ø© %', range:[0,100]} };
  Plotly.newPlot('studentChart',[trace],layout,{displayModeBar:false,responsive:true, staticPlot:true});
}

// ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨ØµÙŠØºØ© d-m-y
window.addEventListener('DOMContentLoaded', (event) => {
  const today = new Date();
  const day = String(today.getDate()).padStart(2, '0');
  const month = String(today.getMonth() + 1).padStart(2, '0');
  const year = today.getFullYear();
  const dateInput = document.getElementById('dateInput');
  if(dateInput) dateInput.value = `${day}-${month}-${year}`;
});

// ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ©
updateChartAndInputs();

// Ø·Ø¨Ø§Ø¹Ø© PDF
function printPDF(){
  const wrapper = document.createElement('div');
  wrapper.style.width='210mm';
  wrapper.style.height='296.5mm';
  wrapper.style.padding='35mm 10mm 20mm 10mm';
  wrapper.style.boxSizing='border-box';
  wrapper.style.overflow='hidden';
  wrapper.style.backgroundImage='url("images/background.png")';
  wrapper.style.backgroundSize='cover';
  wrapper.style.backgroundRepeat='no-repeat';
  wrapper.style.backgroundPosition='center';

  const content = document.querySelector('div[style*="max-width:800px"]').cloneNode(true);
  content.querySelector('button').remove();

  const selects = content.querySelectorAll('select');
  selects.forEach(sel => sel.remove());

  Plotly.toImage(document.getElementById('studentChart'), {format:'png', width:700, height:350}).then(function(dataUrl){
    const img = document.createElement('img');
    img.src = dataUrl;
    img.style.width='100%';
    const chartDiv = content.querySelector('#studentChart');
    if(chartDiv) chartDiv.replaceWith(img);

    wrapper.appendChild(content);

    html2pdf().set({
      margin:0,
      filename:'student_form.pdf',
      image:{type:'jpeg', quality:0.95},
      html2canvas:{scale:3, useCORS:true, backgroundColor:null, scrollY:0},
      jsPDF:{unit:'mm', format:'a4', orientation:'portrait'}
    }).from(wrapper).save();
  });
}
</script>

</body>
</html>
